"use strict";angular.module("app.config",[]).constant("APP_CONFIG",function(){var a="http://localhost:6001";a="http://jlxy.cz";var b={base:a,login:a+"/session",profile:a+"/profile",category:a+"/categories",post:a+"/categories/:categoryId/posts",avatar:a+"/profile/avatar",portfolio:a+"/portfolio"},c={base:"http://qiniu.com",IZONE:"http://i-zone.qiniudn.com/"};return{api:b,qiniu:c}}()),angular.module("app",["ui.router","ui.bootstrap","app.config","app.resource","app.utils","ngAnimate"]).config(["$stateProvider","$urlRouterProvider","$animateProvider","APP_CONFIG",function(a,b,c){a.state("blog",{url:"","abstract":"true",resolve:{categories:["Category",function(a){return a.list({population:!0})}]},templateUrl:"partials/content/blog/blog.tpl.html",controller:"BlogController as blogCtrl"}).state("blog.list",{url:"/",templateUrl:"partials/content/blog/list.tpl.html"}).state("blog.detail",{url:"/categories/:categoryName/posts/:postId",templateUrl:"partials/content/blog/detail.tpl.html",controller:"BlogDetailController as blogDetailCtrl"}).state("user",{url:"/about",resolve:{profile:["Profile",function(a){return a.get()}]},templateUrl:"partials/content/about/about.tpl.html",controller:"AboutController as aboutCtrl"}).state("portfolio",{url:"/portfolio",resolve:{portfolios:["Portfolio",function(a){return a.list()}]},templateUrl:"partials/content/portfolio/portfolio.tpl.html",controller:"PortfolioController as portfolioCtrl"}),b.otherwise("/"),c.classNameFilter(/^((?!(fa-spin)).)*$/)}]).run(["$rootScope","$state",function(a,b){a.$state=b,a.$on("$stateChangeStart",function(){})}]),angular.module("app.utils",[]),angular.module("app.utils").factory("NotificationService",function(){function a(){c.classList.contains("alert")&&(c.classList.remove("alert"),d.innerHTML=""),c.classList.contains("confirm")&&(c.classList.remove("confirm"),f.innerHTML="")}var b={},c=document.getElementById("gl-mask"),d=c.getElementsByClassName("alert-msg")[0],e=c.getElementsByClassName("alert-closer")[0],f=c.getElementsByClassName("confirm-msg")[0],g=c.getElementsByClassName("confirm-btn")[0],h=c.getElementsByClassName("cancel-btn")[0],i=null,j=null,k=null;return b.confirm=function(a,b,d){c.classList.add("confirm"),f.innerHTML=a,i=b,j=d},b.alert=function(a,b){c.classList.add("alert"),d.innerHTML=a,k=b},e.onclick=function(){a(),k&&k()},g.onclick=function(){a(),i()},h.onclick=function(){a(),j()},b}),angular.module("app.utils").directive("markdownHighlight",function(){return{restrict:"EA",replace:!0,scope:{md:"=",rm:"=readmore"},link:function(a,b,c){function d(a){if(a&&(b.html(marked(a)),"true"===c.readMore)){var d=b[0].getElementsByClassName("read-more")[0];d&&d.classList.add("active")}var e=b.find("code");e.length&&angular.forEach(e,function(a){hljs.highlightBlock(a)})}a.$watch("md",d)}}}),angular.module("app.utils").directive("dirDisqus",["$window",function(a){return{restrict:"E",scope:{disqus_shortname:"@disqusShortname",disqus_identifier:"@disqusIdentifier",disqus_title:"@disqusTitle",disqus_url:"@disqusUrl",disqus_category_id:"@disqusCategoryId",disqus_disable_mobile:"@disqusDisableMobile",readyToBind:"@"},template:'<div id="disqus_thread"></div><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>',link:function(b){if("undefined"==typeof b.disqus_identifier||"undefined"==typeof b.disqus_url)throw"Please ensure that the `disqus-identifier` and `disqus-url` attributes are both set.";b.$watch("readyToBind",function(c){if(angular.isDefined(c)||(c="true"),b.$eval(c))if(a.disqus_shortname=b.disqus_shortname,a.disqus_identifier=b.disqus_identifier,a.disqus_title=b.disqus_title,a.disqus_url=b.disqus_url,a.disqus_category_id=b.disqus_category_id,a.disqus_disable_mobile=b.disqus_disable_mobile,a.DISQUS)a.DISQUS.reset({reload:!0,config:function(){this.page.identifier=b.disqus_identifier,this.page.url=b.disqus_url,this.page.title=b.disqus_title}});else{var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src="//"+b.disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d)}})}}}]),angular.module("app.resource",["ngResource"]),angular.module("app.resource").factory("Profile",["$resource","APP_CONFIG",function(a,b){return a(b.api.profile,null,{get:{method:"GET"},update:{method:"PUT"},updateAvatar:{url:b.api.avatar,method:"PUT",transformRequest:function(a,b){var c=b();return c["Content-Type"]=void 0,console.log(c),console.log(a),a}}})}]),angular.module("app.resource").factory("Category",["$resource","APP_CONFIG",function(a,b){return a(b.api.category,null,{list:{method:"GET",isArray:!0},getOne:{method:"GET",url:b.api.category+"/:categoryId"},create:{method:"POST"},update:{method:"PUT",url:b.api.category+"/:categoryId"},"delete":{method:"DELETE",url:b.api.category+"/:categoryId"}})}]),angular.module("app.resource").factory("Post",["$resource","APP_CONFIG",function(a,b){return a(b.api.post,null,{create:{method:"POST"},"delete":{method:"DELETE",url:b.api.post+"/:postId"},list:{method:"GET"},getOne:{method:"GET",url:b.api.post+"/:postId"},update:{method:"PUT",url:b.api.post+"/:postId"}})}]),angular.module("app.resource").factory("Portfolio",["$resource","APP_CONFIG",function(a,b){return a(b.api.portfolio,null,{list:{method:"GET",isArray:!0},getOne:{method:"GET",url:b.api.portfolio+"/:portfolioId"},create:{method:"POST"},update:{method:"PUT",url:b.api.portfolio+"/:portfolioId"},"delete":{method:"DELETE",url:b.api.portfolio+"/:portfolioId"}})}]),angular.module("app").controller("ContentController",["$scope",function(){var a=this;a.status={},a.toggleArchievePanel=function(b){a.status.isArchivePanelHidden=void 0!==b?b:!a.status.isArchivePanelHidden}}]),angular.module("app").controller("BlogController",["$rootScope","$scope","$stateParams","$state","categories","APP_CONFIG",function(a,b,c,d,e,f){function g(a){for(var b=null,c=i.categories.length-1;c>=0;c--)if(i.categories[c]._id===a){b=i.categories[c];break}return b}function h(){for(var a=i.sortedPosts.length-1,b=[];a>=0;a--)b.unshift(new Date(i.sortedPosts[a].createdAt));for(a=b.length-1;a>=0;a--)if(b[a+1]&&b[a].getFullYear()===b[a+1].getFullYear()&&b[a].getMonth()===b[a+1].getMonth())i.archives[0].posts.push(i.sortedPosts[a]);else{var c={title:""+b[a].getFullYear()+"/"+(b[a].getMonth()+1),posts:[]};c.posts.push(i.sortedPosts[a]),i.archives.unshift(c)}}var i=this;i.categories=e,console.log("////////// blog controller ///////////"),i.sortedPosts=[],i.archives=[],i.status={},i.status.postsViewType="categories",i.domain=f.api.base,i.changePostsViewType=function(a){i.status.postsViewType=a},i.setCurrentCategory=function(a){i.currentCategory=g(a),i.status.viewingPosts=!0,console.log(i.currentCategory)},i.readMore=function(a,b,c){c.preventDefault(),c.stopPropagation();angular.element(c.target);angular.element(c.target).hasClass("read-more")&&(i.status.readingPost=!0,d.go("blog.detail",{categoryName:a,postId:b}))},i.sortPosts=function(){for(var a=i.categories.length-1;a>=0;a--)i.sortedPosts=i.sortedPosts.concat(i.categories[a].posts.map(function(b){return b.category=i.categories[a].name,b.cid=i.categories[a]._id,b}));i.sortedPosts.sort(function(a,b){return b.createdAt>a.createdAt?1:b.createdAt<a.createdAt?-1:0}),h()},i.categories.$promise.then(function(){i.sortPosts()}),b.$on("viewPost",function(){}),b.$parent.contentCtrl.status.isArchivePanelHidden=!1,b.$on("$viewContentLoaded",function(){a.title="Post"})}]),angular.module("app").controller("BlogDetailController",["$rootScope","$scope","$stateParams","$location","APP_CONFIG",function(a,b,c,d,e){var f=this;f.domain=e.api.base,f.categories=b.$parent.blogCtrl.categories,b.$parent.$parent.contentCtrl.status.isArchivePanelHidden=!0,f.categories.$promise.then(function(){for(var b=f.categories.length-1;b>=0;b--)if(f.categories[b].name===c.categoryName){f.category=f.categories[b];break}for(b=f.category.posts.length-1;b>=0;b--)if(f.category.posts[b]._id===c.postId){f.post=f.category.posts[b],a.title=f.post.title;break}}),b.$on("$viewContentLoaded",function(){})}]),angular.module("app").controller("AboutController",["$scope","$rootScope","profile",function(a,b,c){var d=this;d.profile=c,d.profile.$promise.then(function(){console.log("//////// about page //////"),console.log(d)}),a.$on("$viewContentLoaded",function(){b.title="about me"})}]),angular.module("app").controller("PortfolioController",["$scope","$rootScope","$window","Portfolio","portfolios","APP_CONFIG",function(a,b,c,d,e,f){var g=this;g.status={},g.portfolios=e,e.$promise.then(function(){console.log(e),g.portfolios=e.map(function(a){return a.src=f.qiniu.IZONE+a.key+"?imageView2/2/w/1000",a})}),g.viewPortfolio=function(a){c.innerWidth<560||(g.portfolio=a,g.status.viewingItem=!g.status.viewingItem)},a.$on("$viewContentLoaded",function(){b.title="portfolios"})}]);